<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="author" content="Vivian Huang">
<meta name="created" content="2013-05-31">
<meta name="modified" content="Fri 31 May 2013 07:09:54 PM CST">
<title>jsTree Prototype</title>
<link rel="stylesheet" href="../src/jstree.css">
<script type="text/javascript" src="../libs/jquery.js"></script>
<!--<script type="text/javascript" src="../src/jstree.js"></script>
<script type="text/javascript" src="../src/jstree.json.js"></script>
<script type="text/javascript" src="../src/jstree.html.js"></script>-->
<script type="text/javascript" src="js/jquery.jstree.js"></script>
<style type="text/css">

</style>
</head>
<body>
    <div id="demo1" class="jstree">
        <ul>
            <li class="jstree-open">
                <ins class="jstree-icon">&nbsp;</ins>
                <a href="#" class=""><ins class="jstree-icon">&nbsp;</ins>Root node 1</a>
                <ul>
                    <li class="jstree-leaf">
                        <ins class="jstree-icon">&nbsp;</ins>
                        <a href="#" class="jstree-clicked"><ins class="jstree-icon">&nbsp;</ins>Child node 1</a>
                    </li>
                    <li class="jstree-last jstree-leaf">
                        <ins class="jstree-icon">&nbsp;</ins>
                        <a href="#"><ins class="jstree-icon">&nbsp;</ins>Child node 2</a>
                    </li>
                </ul>
            </li>
            <li class="jstree-last jstree-leaf">
                <ins class="jstree-icon">&nbsp;</ins>
                <a href="#" class=""><ins class="jstree-icon">&nbsp;</ins>Root node 2</a>
            </li>
        </ul>
    </div>

    <div id="demo" class="demo" style="height:200px;"></div>

    <div id="demo1" class="demo"></div>
    <script type="text/javascript">
    $(function () {
        $("#demo1").jstree({ 
            "json_data" : {
                "data" : [
                    { 
                        "data" : "A node", 
                        "metadata" : { id : 23 },
                        "children" : [ "Child 1", "A Child 2" ]
                    },
                    { 
                        "attr" : { "id" : "li.node.id1" }, 
                        "data" : { 
                            "title" : "Long format demo", 
                            "attr" : { "href" : "#" } 
                        } 
                    }
                ]
            },
            "plugins" : [ "themes", "json_data", "ui" ]
        }).bind("select_node.jstree", function (e, data) { alert(data.rslt.obj.data("id")); });
    });
    </script>


    <script type="text/javascript" class="source">
        // http://luban.danse.us/jazzclub/javascripts/jquery/jsTree/reference/_examples/5_others.html
        $(function () {
            /*
            $('#demo1').jstree({
                "plugins" : ["themes","html_data","ui","crrm","hotkeys"],
                "core" : { "initially_open" : [ "phtml_1" ] }
                }).bind('loaded.jstree', function (e, data) {
                console.log('loaded.jstree');
            });
            */
            /*
            $('#demo1').jstree({
                'plugins': ['contextmenu']
            }).bind('click.jstree', function (e, data) {
                console.log('click.jstree');
            }).bind('open_node.jstree', function (e, data) {
                console.log('open_node.jstree');
            }).bind('select_node.jstree', function (e, data) {
                console.log('select_node.jstree');
            });
            */


            var data = [{"attr":{"id":"node_160","rel":"folder"},"data":"New node","state":""},{"attr":{"id":"node_245","rel":"folder"},"data":"New node","state":"closed"},{"attr":{"id":"node_161","rel":"folder"},"data":"New node","state":""},{"attr":{"id":"node_243","rel":"folder"},"data":"New node","state":""},{"attr":{"id":"node_159","rel":"folder"},"data":"New node","state":"closed"},{"attr":{"id":"node_163","rel":"folder"},"data":"New node","state":""},{"attr":{"id":"node_166","rel":"folder"},"data":"New node","state":""},{"attr":{"id":"node_167","rel":"folder"},"data":"New node","state":""},{"attr":{"id":"node_244","rel":"folder"},"data":"New node","state":""},{"attr":{"id":"node_162","rel":"folder"},"data":"New node","state":"closed"},{"attr":{"id":"node_175","rel":"default"},"data":"New node","state":""},{"attr":{"id":"node_176","rel":"default"},"data":"New node","state":""},{"attr":{"id":"node_170","rel":"folder"},"data":"New node","state":"closed"},{"attr":{"id":"node_217","rel":"default"},"data":"New node","state":""},{"attr":{"id":"node_219","rel":"folder"},"data":"New node","state":"closed"},{"attr":{"id":"node_220","rel":"default"},"data":"New node","state":""},{"attr":{"id":"node_233","rel":"default"},"data":"New node","state":""},{"attr":{"id":"node_141","rel":"folder"},"data":"New node","state":"closed"},{"attr":{"id":"node_137","rel":"folder"},"data":"New node","state":""},{"attr":{"id":"node_237","rel":"folder"},"data":"New node","state":"closed"}];

            
            $("#demo")
                .bind("before.jstree", function (e, data) {
                    $("#alog").append(data.func + "<br />");
                })
                .jstree({ 
                    // List of active plugins
                    "plugins" : [ 
                        "themes","json_data","ui","crrm","cookies","dnd","search","types","hotkeys","contextmenu" 
                    ],

                    // I usually configure the plugin that handles the data first
                    // This example uses JSON as it is most common
                    "json_data" : { 
                        // This tree is ajax enabled - as this is most common, and maybe a bit more complex
                        // All the options are almost the same as jQuery's AJAX (read the docs)
                        "ajax" : {
                            // the URL to fetch the data
                            "url" : "/static/v.1.0pre/_demo/server.php",
                            // the `data` function is executed in the instance's scope
                            // the parameter is the node being loaded 
                            // (may be -1, 0, or undefined when loading the root nodes)
                            "data" : function (n) { 
                                // the result is fed to the AJAX request `data` option
                                return { 
                                    "operation" : "get_children", 
                                    "id" : n.attr ? n.attr("id").replace("node_","") : 1 
                                }; 
                            }
                        }
                    },
                    // Configuring the search plugin
                    "search" : {
                        // As this has been a common question - async search
                        // Same as above - the `ajax` config option is actually jQuery's AJAX object
                        "ajax" : {
                            "url" : "/static/v.1.0pre/_demo/server.php",
                            // You get the search string as a parameter
                            "data" : function (str) {
                                return { 
                                    "operation" : "search", 
                                    "search_str" : str 
                                }; 
                            }
                        }
                    },
                    // Using types - most of the time this is an overkill
                    // read the docs carefully to decide whether you need types
                    "types" : {
                        // I set both options to -2, as I do not need depth and children count checking
                        // Those two checks may slow jstree a lot, so use only when needed
                        "max_depth" : -2,
                        "max_children" : -2,
                        // I want only `drive` nodes to be root nodes 
                        // This will prevent moving or creating any other type as a root node
                        "valid_children" : [ "drive" ],
                        "types" : {
                            // The default type
                            "default" : {
                                // I want this type to have no children (so only leaf nodes)
                                // In my case - those are files
                                "valid_children" : "none",
                                // If we specify an icon for the default type it WILL OVERRIDE the theme icons
                                "icon" : {
                                    "image" : "/static/v.1.0pre/_demo/file.png"
                                }
                            },
                            // The `folder` type
                            "folder" : {
                                // can have files and other folders inside of it, but NOT `drive` nodes
                                "valid_children" : [ "default", "folder" ],
                                "icon" : {
                                    "image" : "/static/v.1.0pre/_demo/folder.png"
                                }
                            },
                            // The `drive` nodes 
                            "drive" : {
                                // can have files and folders inside, but NOT other `drive` nodes
                                "valid_children" : [ "default", "folder" ],
                                "icon" : {
                                    "image" : "/static/v.1.0pre/_demo/root.png"
                                },
                                // those prevent the functions with the same name to be used on `drive` nodes
                                // internally the `before` event is used
                                "start_drag" : false,
                                "move_node" : false,
                                "delete_node" : false,
                                "remove" : false
                            }
                        }
                    },
                    // UI & core - the nodes to initially select and open will be overwritten by the cookie plugin

                    // the UI plugin - it handles selecting/deselecting/hovering nodes
                    "ui" : {
                        // this makes the node with ID node_4 selected onload
                        "initially_select" : [ "node_4" ]
                    },
                    // the core plugin - not many options here
                    "core" : { 
                        // just open those two nodes up
                        // as this is an AJAX enabled tree, both will be downloaded from the server
                        "initially_open" : [ "node_2" , "node_3" ] 
                    }
                })
                .bind("create.jstree", function (e, data) {
                    $.post(
                        "/static/v.1.0pre/_demo/server.php", 
                        { 
                            "operation" : "create_node", 
                            "id" : data.rslt.parent.attr("id").replace("node_",""), 
                            "position" : data.rslt.position,
                            "title" : data.rslt.name,
                            "type" : data.rslt.obj.attr("rel")
                        }, 
                        function (r) {
                            if(r.status) {
                                $(data.rslt.obj).attr("id", "node_" + r.id);
                            }
                            else {
                                $.jstree.rollback(data.rlbk);
                            }
                        }
                    );
                })
                .bind("remove.jstree", function (e, data) {
                    data.rslt.obj.each(function () {
                        $.ajax({
                            async : false,
                            type: 'POST',
                            url: "/static/v.1.0pre/_demo/server.php",
                            data : { 
                                "operation" : "remove_node", 
                                "id" : this.id.replace("node_","")
                            }, 
                            success : function (r) {
                                if(!r.status) {
                                    data.inst.refresh();
                                }
                            }
                        });
                    });
                })
                .bind("rename.jstree", function (e, data) {
                    $.post(
                        "/static/v.1.0pre/_demo/server.php", 
                        { 
                            "operation" : "rename_node", 
                            "id" : data.rslt.obj.attr("id").replace("node_",""),
                            "title" : data.rslt.new_name
                        }, 
                        function (r) {
                            if(!r.status) {
                                $.jstree.rollback(data.rlbk);
                            }
                        }
                    );
                })
                .bind("move_node.jstree", function (e, data) {
                    data.rslt.o.each(function (i) {
                        $.ajax({
                            async : false,
                            type: 'POST',
                            url: "/static/v.1.0pre/_demo/server.php",
                            data : { 
                                "operation" : "move_node", 
                                "id" : $(this).attr("id").replace("node_",""), 
                                "ref" : data.rslt.cr === -1 ? 1 : data.rslt.np.attr("id").replace("node_",""), 
                                "position" : data.rslt.cp + i,
                                "title" : data.rslt.name,
                                "copy" : data.rslt.cy ? 1 : 0
                            },
                            success : function (r) {
                                if(!r.status) {
                                    $.jstree.rollback(data.rlbk);
                                }
                                else {
                                    $(data.rslt.oc).attr("id", "node_" + r.id);
                                    if(data.rslt.cy && $(data.rslt.oc).children("UL").length) {
                                        data.inst.refresh(data.inst._get_parent(data.rslt.oc));
                                    }
                                }
                                $("#analyze").click();
                            }
                        });
                    });
                });
                


        });
    </script>
</body>
</html>
